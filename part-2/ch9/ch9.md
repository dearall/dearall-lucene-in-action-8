# 第9章 Lucene 基准测试模块 Benchmark #

Lucene 的基准测试模块 benchmark 是运行可重复性能测试非常有用的框架。通过创建一个短小的脚本文件，称为算法（以 .alg 为后缀）脚本，来告诉 benchmark 模块要运行什么测试，以及如何对其测试结果输出总结报告。算法文件是以 UTF-8 编码的文本文件。在 byTask 子包的包级 Javadoc，对 benchmark 进行了大量的阐述。 

&emsp;&emsp;可能会想要创建自己的测试框架，而不是学习如何使用 benchmark 模块。但这里有一些重要的理由让我们做一些提前的投资来使用 benchmark 模块提供的测试框架：

**■** 因为算法文件是非常简单的文本文件，它很容易且快捷地与他人进行分享，使他们能获得与我们一样的测试结果。这在视图追查性能异常并想要与内容源进行隔离的场景，极其重要。而对于自己单独测试框架，经常需要很多的软件依赖，并且还有可能需要其它资源，例如本地文件或者数据库，再以某种方式传递给其它人运行测试。

**■** benchmark 框架已经内置了对通用标准文档源的支持，例如路透社文档集 Reuters, 维基百科 Wikipedia, 以及文本检索 TREC。


**■** 使用自己的测试，很容易造成测试代码本身额外的性能开销，甚至是 bug，这会使测试结果不准确。benchmark 包，因为是开源的，是经过大量 bug 修复和调优的，它具有很低的可能性造成这类问题，并且它会随着时间的推移越来越好。


**■** 由于大量的内置任务，我们无需编写任何 Java 代码，就可以创建非常丰富的算法。通过对算法文件编写几行算法，就可以制作出几乎想要的任何测试。如果想要测试其它内容，只需要修改算法脚本，并重新运行即可，无需编译。


**■** benchmark 有多个扩展点，很容易自定义文档源（source of documents）、查询源（source of queries），以及结束时如何报告性能指标。对于高级应用场景，也可以创建并插入自己的任务。


**■** benchmark 已经收集了重要的指标，例如运行时、每秒文档数，以及内存使用，把我们从必须要在自定义测试代码中插入指令解脱出来。




































